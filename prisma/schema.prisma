// TODO - Logika penilaian taksiran jaminan
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id       String   @id @default(uuid()) @map("id") @db.VarChar(56)
  name     String   @map("name") @db.VarChar(100)
  username String   @unique @map("username") @db.VarChar(50)
  email    String   @unique @map("email") @db.VarChar(150)
  phone    String?  @unique @map("phone") @db.VarChar(20)
  avatar   String?  @map("avatar")
  image    String?  @map("image")
  role     UserRole @default(ADMIN) @map("role")

  settings    Settings?
  permissions Permissions?
  customer    Customer? // Relasi one-to-one dengan Customer

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_user_id")
  @@index([name], name: "idx_user_name")
  @@index([username], name: "idx_user_username")
  @@index([email], name: "idx_user_email")
  @@index([phone], name: "idx_user_phone")
  @@index([avatar], name: "idx_user_avatar")
  @@index([image], name: "idx_user_image")
  @@index([role], name: "idx_user_role")
  @@index([createdAt], name: "idx_user_created_at")
  @@index([updatedAt], name: "idx_user_updated_at")
  @@map("users")
}

model Settings {
  id           String   @id @default(uuid()) @map("id") @db.VarChar(56)
  theme        Theme    @default(SYSTEM) @map("theme")
  language     Language @default(ID) @map("language")
  notification Boolean  @default(true) @map("notification")

  userId String @unique @map("user_id") @db.VarChar(56)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_settings_id")
  @@index([theme], name: "idx_settings_theme")
  @@index([language], name: "idx_settings_language")
  @@index([notification], name: "idx_settings_notification")
  @@index([userId], name: "idx_settings_user_id")
  @@index([createdAt], name: "idx_settings_created_at")
  @@index([updatedAt], name: "idx_settings_updated_at")
  @@map("settings")
}

model Permissions {
  id           String  @id @default(uuid()) @map("id") @db.VarChar(56)
  createReport Boolean @default(false) @map("create_report")

  userId String @unique @map("user_id") @db.VarChar(56)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_permissions_id")
  @@index([createReport], name: "idx_permissions_create_report")
  @@index([userId], name: "idx_permissions_user_id")
  @@index([createdAt], name: "idx_permissions_created_at")
  @@index([updatedAt], name: "idx_permissions_updated_at")
  @@map("permissions")
}

model Notification {
  id          String           @id @default(uuid()) @map("id") @db.VarChar(56)
  type        NotificationType @map("type") // Tipe notifikasi (SYSTEM atau PERSONAL)
  category    String           @map("category") @db.VarChar(100) // Kategori notifikasi (LOAN_APPROVED, PAYMENT_DUE, dll)
  title       String           @map("title") @db.VarChar(150) // Judul notifikasi
  message     String           @map("message") @db.Text // Isi pesan notifikasi
  actionUrl   String?          @map("action_url") @db.VarChar(255) // URL untuk action button (opsional)
  actionLabel String?          @map("action_label") @db.VarChar(50) // Label untuk action button (opsional)
  priority    Priority         @default(NORMAL) @map("priority") // Prioritas notifikasi
  isRead      Boolean          @default(false) @map("is_read") // Status sudah dibaca
  readAt      DateTime?        @map("read_at") // Tanggal dibaca
  relatedType String?          @map("related_type") @db.VarChar(50) // Tipe relasi (LOAN, PAYMENT, APPLICATION, dll)

  relatedId String? @map("related_id") @db.VarChar(56) // ID terkait (loan_id, payment_id, dll)
  userId    String? @map("user_id") @db.VarChar(56) // Null jika notifikasi sistem, berisi user_id jika personal
  // Tidak ada relasi langsung ke User untuk fleksibilitas

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_notification_id")
  @@index([type], name: "idx_notification_type")
  @@index([category], name: "idx_notification_category")
  @@index([title], name: "idx_notification_title")
  @@index([message], name: "idx_notification_message")
  @@index([actionUrl], name: "idx_notification_action_url")
  @@index([actionLabel], name: "idx_notification_action_label")
  @@index([priority], name: "idx_notification_priority")
  @@index([isRead], name: "idx_notification_is_read")
  @@index([readAt], name: "idx_notification_read_at")
  @@index([relatedType], name: "idx_notification_related_type")
  @@index([relatedId], name: "idx_notification_related_id")
  @@index([userId], name: "idx_notification_user_id")
  @@index([createdAt], name: "idx_notification_created_at")
  @@index([updatedAt], name: "idx_notification_updated_at")
  @@map("notifications")
}

model Customer {
  id               String         @id @default(uuid()) @map("id") @db.VarChar(56)
  fullName         String         @map("full_name") @db.VarChar(150) // Nama lengkap nasabah
  nationalId       String         @unique @map("national_id") @db.VarChar(20) // NIK/KTP
  birthPlace       String         @map("birth_place") @db.VarChar(100) // Tempat lahir
  birthDate        DateTime       @map("birth_date") @db.Date // Tanggal lahir
  gender           Gender         @map("gender") // Jenis kelamin
  phone            String         @map("phone") @db.VarChar(20) // Nomor telepon
  email            String?        @map("email") @db.VarChar(150) // Email nasabah
  address          String         @map("address") @db.Text // Alamat lengkap
  maritalStatus    MaritalStatus  @map("marital_status") // Status pernikahan
  employmentType   EmploymentType @map("employment_type") // Jenis pekerjaan
  employmentName   String?        @map("employment_name") @db.VarChar(150) // Nama perusahaan/usaha
  employmentPeriod Int?           @map("employment_period") // Lama bekerja (dalam bulan)

  userId String? @unique @map("user_id") @db.VarChar(56) // Relasi dengan User (opsional untuk pengajuan offline)
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  document           Document? // Dokumen-dokumen Customer
  bankAccounts       BankAccount[]
  guarantors         Guarantor[] // Guarantor sebagai penjamin 
  creditApplications CreditApplication[] // Pengajuan kredit
  loanReferences     LoanReference[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_customer_id")
  @@index([fullName], name: "idx_customer_full_name")
  @@index([nationalId], name: "idx_customer_national_id")
  @@index([birthPlace], name: "idx_customer_birth_place")
  @@index([birthDate], name: "idx_customer_birth_date")
  @@index([gender], name: "idx_customer_gender")
  @@index([phone], name: "idx_customer_phone")
  @@index([email], name: "idx_customer_email")
  @@index([address], name: "idx_customer_address")
  @@index([maritalStatus], name: "idx_customer_marital_status")
  @@index([employmentType], name: "idx_customer_employment_type")
  @@index([employmentName], name: "idx_customer_employment_name")
  @@index([employmentPeriod], name: "idx_customer_employment_period")
  @@index([userId], name: "idx_customer_user_id")
  @@index([createdAt], name: "idx_customer_created_at")
  @@index([updatedAt], name: "idx_customer_updated_at")
  @@map("customers")
}

model BankAccount {
  id            String  @id @default(uuid()) @map("id") @db.VarChar(56)
  accountName   String  @map("account_name") // nama pemilik rekening
  accountNumber String  @map("account_number")
  isPrimary     Boolean @default(false) @map("is_primary")
  isVerified    Boolean @default(false) @map("is_verified")
  isActive      Boolean @default(true) @map("is_active")

  customerId         String              @map("customer_id")
  customer           Customer            @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  creditApplications CreditApplication[] // Pengajuan kredit

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_bank_account_id")
  @@index([accountName], name: "idx_bank_account_name")
  @@index([accountNumber], name: "idx_bank_account_number")
  @@index([isPrimary], name: "idx_bank_account_is_primary")
  @@index([isVerified], name: "idx_bank_account_is_verified")
  @@index([isActive], name: "idx_bank_account_is_active")
  @@index([customerId], name: "idx_bank_account_customer_id")
  @@index([createdAt], name: "idx_bank_account_created_at")
  @@index([updatedAt], name: "idx_bank_account_updated_at")
  @@map("bank_accounts")
}

model Guarantor {
  id               String         @id @default(uuid()) @map("id") @db.VarChar(56)
  fullName         String         @map("full_name") @db.VarChar(150) // Nama lengkap penjamin
  nationalId       String         @map("national_id") @db.VarChar(20) // NIK/KTP penjamin
  birthPlace       String         @map("birth_place") @db.VarChar(100) // Tempat lahir
  birthDate        DateTime       @map("birth_date") @db.Date // Tanggal lahir
  gender           Gender         @map("gender") // Jenis kelamin
  address          String         @map("address") @db.Text // Alamat lengkap
  phone            String         @map("phone") @db.VarChar(20) // Nomor telepon
  email            String?        @map("email") @db.VarChar(150) // Email penjamin
  maritalStatus    MaritalStatus  @map("marital_status") // Status pernikahan
  employmentType   EmploymentType @map("employment_type") // Jenis pekerjaan
  employmentName   String?        @map("employment_name") @db.VarChar(150) // Nama perusahaan/usaha
  employmentPeriod Int?           @map("employment_period") // Lama bekerja (dalam bulan)
  relationship     Relationship   @map("relationship") // Hubungan dengan peminjam

  customerId String   @map("customer_id") @db.VarChar(56) // Relasi dengan Customer yang dijamin
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  document           Document? // Dokumen-dokumen Guarantor
  creditApplications CreditApplication[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_guarantor_id")
  @@index([fullName], name: "idx_guarantor_full_name")
  @@index([nationalId], name: "idx_guarantor_national_id")
  @@index([birthPlace], name: "idx_guarantor_birth_place")
  @@index([birthDate], name: "idx_guarantor_birth_date")
  @@index([gender], name: "idx_guarantor_gender")
  @@index([address], name: "idx_guarantor_address")
  @@index([phone], name: "idx_guarantor_phone")
  @@index([email], name: "idx_guarantor_email")
  @@index([maritalStatus], name: "idx_guarantor_marital_status")
  @@index([employmentType], name: "idx_guarantor_employment_type")
  @@index([employmentName], name: "idx_guarantor_employment_name")
  @@index([employmentPeriod], name: "idx_guarantor_employment_period")
  @@index([relationship], name: "idx_guarantor_relationship")
  @@index([customerId], name: "idx_guarantor_customer_id")
  @@index([createdAt], name: "idx_guarantor_created_at")
  @@index([updatedAt], name: "idx_guarantor_updated_at")
  @@map("guarantors")
}

model Document {
  id            String  @id @default(uuid()) @map("id") @db.VarChar(56)
  identityCard  String? @map("identity_card") // Gambar KTP
  familyCard    String? @map("family_card") // Gambar KK
  salarySlip    String? @map("salary_slip") // Slip gaji
  bankStatement String? @map("bank_statement") // Rekening koran
  selfie        String? @map("selfie") // Foto Selfie

  customerId  String?    @unique @map("customer_id") @db.VarChar(56) // Relasi opsional dengan Customer
  customer    Customer?  @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  guarantorId String?    @unique @map("guarantor_id") @db.VarChar(56) // Relasi opsional dengan Guarantor
  guarantor   Guarantor? @relation(fields: [guarantorId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_document_id")
  @@index([identityCard], name: "idx_document_identity_card")
  @@index([familyCard], name: "idx_document_family_card")
  @@index([salarySlip], name: "idx_document_salary_slip")
  @@index([bankStatement], name: "idx_document_bank_statement")
  @@index([selfie], name: "idx_document_selfie")
  @@index([customerId], name: "idx_document_customer_id")
  @@index([guarantorId], name: "idx_document_guarantor_id")
  @@index([createdAt], name: "idx_document_created_at")
  @@index([updatedAt], name: "idx_document_updated_at")
  @@map("documents")
}

model CreditApplication {
  id                String            @id @default(uuid()) @map("id") @db.VarChar(56)
  applicationNumber String            @unique @map("application_number") @db.VarChar(50) // Nomor pengajuan
  loanType          LoanType          @map("loan_type") // Jenis pinjaman
  loanAmount        Int               @map("loan_amount") // Jumlah pinjaman yang diajukan
  loanPeriod        Int               @map("loan_period") // Jangka waktu (bulan)
  loanPurpose       String?           @map("loan_purpose") @db.Text // Tujuan pinjaman
  collateralCert    String?           @map("collateral_cert") // Sertifikat agunan
  collateralValue   Int?              @map("collateral_value") // Nilai agunan (jika ada)
  monthlyIncome     Int               @map("monthly_income") // Pendapatan per bulan
  incomeProof       String?           @map("income_proof") // Bukti pendapatan
  monthlyExpenses   Int               @map("monthly_expenses") // Pengeluaran per bulan
  surplus           Int               @map("surplus") // Surplus (pendapatan - pengeluaran) per bulan
  status            ApplicationStatus @default(DRAFT) @map("status") // Status pengajuan
  submittedAt       DateTime?         @map("submitted_at") // Tanggal pengajuan
  reviewedAt        DateTime?         @map("reviewed_at") // Tanggal ditinjau
  approvedAt        DateTime?         @map("approved_at") // Tanggal disetujui
  rejectedAt        DateTime?         @map("rejected_at") // Tanggal ditolak
  rejectionReason   String?           @map("rejection_reason") @db.Text // Alasan penolakan
  disbursedAt       DateTime?         @map("disbursed_at") // Tanggal pencairan
  reviewedBy        String?           @map("reviewed_by") @db.VarChar(56) // ID admin yang meninjau
  approvedBy        String?           @map("approved_by") @db.VarChar(56) // ID admin yang menyetujui
  notes             String?           @map("notes") @db.Text // Catatan tambahan

  customerId       String            @map("customer_id") @db.VarChar(56) // Relasi dengan Customer
  customer         Customer          @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  guarantorId      String            @map("guarantor_id") @db.VarChar(56) // Relasi opsional dengan Guarantor
  guarantor        Guarantor         @relation(fields: [guarantorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  bankAccountId    String            @db.VarChar(56)
  bankAccount      BankAccount       @relation(fields: [bankAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  loanReference    LoanReference? // Referensi pinjaman jika disetujui
  creditWorthiness CreditWorthiness? // Penilaian kelayakan kredit

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_credit_application_id")
  @@index([applicationNumber], name: "idx_credit_application_number")
  @@index([loanType], name: "idx_credit_application_loan_type")
  @@index([loanAmount], name: "idx_credit_application_loan_amount")
  @@index([loanPeriod], name: "idx_credit_application_loan_period")
  @@index([loanPurpose], name: "idx_credit_application_loan_purpose")
  @@index([collateralCert], name: "idx_credit_application_collateral_cert")
  @@index([collateralValue], name: "idx_credit_application_collateral_value")
  @@index([monthlyIncome], name: "idx_credit_application_monthly_income")
  @@index([incomeProof], name: "idx_credit_application_income_proof")
  @@index([monthlyExpenses], name: "idx_credit_application_monthly_expenses")
  @@index([surplus], name: "idx_credit_application_surplus")
  @@index([status], name: "idx_credit_application_status")
  @@index([submittedAt], name: "idx_credit_application_submitted_at")
  @@index([reviewedAt], name: "idx_credit_application_reviewed_at")
  @@index([approvedAt], name: "idx_credit_application_approved_at")
  @@index([rejectedAt], name: "idx_credit_application_rejected_at")
  @@index([rejectionReason], name: "idx_credit_application_rejection_reason")
  @@index([disbursedAt], name: "idx_credit_application_disbursed_at")
  @@index([reviewedBy], name: "idx_credit_application_reviewed_by")
  @@index([approvedBy], name: "idx_credit_application_approved_by")
  @@index([notes], name: "idx_credit_application_notes")
  @@index([customerId], name: "idx_credit_application_customer_id")
  @@index([guarantorId], name: "idx_credit_application_guarantor_id")
  @@index([bankAccountId], name: "idx_credit_application_bank_account_id")
  @@index([createdAt], name: "idx_credit_application_created_at")
  @@index([updatedAt], name: "idx_credit_application_updated_at")
  @@map("credit_applications")
}

model CreditWorthiness {
  id               String      @id @default(uuid()) @map("id") @db.VarChar(56)
  creditScore      CreditScore @map("credit_score") // Skor kredit
  assessmentResult String      @map("assessment_result") @db.Text // Hasil penilaian
  assessedBy       String      @map("assessed_by") @db.VarChar(56) // ID admin yang menilai
  assessedAt       DateTime    @default(now()) @map("assessed_at") // Tanggal penilaian

  creditApplicationId String            @unique @map("credit_application_id") @db.VarChar(56)
  creditApplication   CreditApplication @relation(fields: [creditApplicationId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_credit_worthiness_id")
  @@index([creditScore], name: "idx_credit_worthiness_credit_score")
  @@index([assessmentResult], name: "idx_credit_worthiness_assessment_result")
  @@index([assessedBy], name: "idx_credit_worthiness_assessed_by")
  @@index([assessedAt], name: "idx_credit_worthiness_assessed_at")
  @@index([creditApplicationId], name: "idx_credit_worthiness_credit_application_id")
  @@index([createdAt], name: "idx_credit_worthiness_created_at")
  @@index([updatedAt], name: "idx_credit_worthiness_updated_at")
  @@map("credit_worthinesses")
}

model LoanReference {
  id              String     @id @default(uuid()) @map("id") @db.VarChar(56)
  loanNumber      String     @unique @map("loan_number") @db.VarChar(50) // Nomor pinjaman
  principalAmount Int        @map("principal_amount") // Jumlah pokok pinjaman
  interestRate    Int        @map("interest_rate") // Suku bunga per tahun (%)
  loanPeriod      Int        @map("loan_period") // Jangka waktu (bulan)
  monthlyPayment  Int        @map("monthly_payment") // Angsuran per bulan
  totalPayment    Int        @map("total_payment") // Total pembayaran
  status          LoanStatus @default(ACTIVE) @map("status") // Status pinjaman
  startDate       DateTime   @map("start_date") @db.Date // Tanggal mulai
  endDate         DateTime   @map("end_date") @db.Date // Tanggal jatuh tempo
  nextPaymentDate DateTime   @map("next_payment_date") @db.Date // Tanggal pembayaran berikutnya
  overdueCount    Int        @default(0) @map("overdue_count") // Jumlah tunggakan
  lateFeeAmount   Int        @default(0) @map("late_fee_amount") // Denda keterlambatan

  customerId          String            @map("customer_id") @db.VarChar(56) // Relasi dengan Customer
  customer            Customer          @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  creditApplicationId String            @unique @map("credit_application_id") @db.VarChar(56)
  creditApplication   CreditApplication @relation(fields: [creditApplicationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  loanBalance         LoanBalance? // Saldo pinjaman
  paymentRecords      PaymentRecord[] // Riwayat pembayaran

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_loan_reference_id")
  @@index([loanNumber], name: "idx_loan_reference_loan_number")
  @@index([principalAmount], name: "idx_loan_reference_principal_amount")
  @@index([interestRate], name: "idx_loan_reference_interest_rate")
  @@index([loanPeriod], name: "idx_loan_reference_loan_period")
  @@index([monthlyPayment], name: "idx_loan_reference_monthly_payment")
  @@index([totalPayment], name: "idx_loan_reference_total_payment")
  @@index([status], name: "idx_loan_reference_status")
  @@index([startDate], name: "idx_loan_reference_start_date")
  @@index([endDate], name: "idx_loan_reference_end_date")
  @@index([nextPaymentDate], name: "idx_loan_reference_next_payment_date")
  @@index([overdueCount], name: "idx_loan_reference_overdue_count")
  @@index([lateFeeAmount], name: "idx_loan_reference_late_fee_amount")
  @@index([customerId], name: "idx_loan_reference_customer_id")
  @@index([creditApplicationId], name: "idx_loan_reference_credit_application_id")
  @@index([createdAt], name: "idx_loan_reference_created_at")
  @@index([updatedAt], name: "idx_loan_reference_updated_at")
  @@map("loan_references")
}

model LoanBalance {
  id                 String    @id @default(uuid()) @map("id") @db.VarChar(56)
  principalRemaining Int       @map("principal_remaining") // Sisa pokok pinjaman
  interestRemaining  Int       @map("interest_remaining") // Sisa bunga
  totalRemaining     Int       @map("total_remaining") // Total sisa pinjaman
  principalPaid      Int       @map("principal_paid") // Pokok yang sudah dibayar
  interestPaid       Int       @map("interest_paid") // Bunga yang sudah dibayar
  totalPaid          Int       @map("total_paid") // Total yang sudah dibayar
  lateFeeTotal       Int       @default(0) @map("late_fee_total") // Total denda
  lastPaymentDate    DateTime? @map("last_payment_date") @db.Date // Tanggal pembayaran terakhir
  lastPaymentAmount  Int       @default(0) @map("last_payment_amount") // Jumlah pembayaran terakhir

  loanReferenceId String        @unique @map("loan_reference_id") @db.VarChar(56)
  loanReference   LoanReference @relation(fields: [loanReferenceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_loan_balance_id")
  @@index([principalRemaining], name: "idx_loan_balance_principal_remaining")
  @@index([interestRemaining], name: "idx_loan_balance_interest_remaining")
  @@index([totalRemaining], name: "idx_loan_balance_total_remaining")
  @@index([principalPaid], name: "idx_loan_balance_principal_paid")
  @@index([interestPaid], name: "idx_loan_balance_interest_paid")
  @@index([totalPaid], name: "idx_loan_balance_total_paid")
  @@index([lateFeeTotal], name: "idx_loan_balance_late_fee_total")
  @@index([lastPaymentDate], name: "idx_loan_balance_last_payment_date")
  @@index([lastPaymentAmount], name: "idx_loan_balance_last_payment_amount")
  @@index([loanReferenceId], name: "idx_loan_balance_loan_reference_id")
  @@index([createdAt], name: "idx_loan_balance_created_at")
  @@index([updatedAt], name: "idx_loan_balance_updated_at")
  @@map("loan_balances")
}

model PaymentRecord {
  id                String        @id @default(uuid()) @map("id") @db.VarChar(56)
  installmentNumber Int           @map("installment_number") // Angsuran ke-
  dueDate           DateTime      @map("due_date") @db.Date // Tanggal jatuh tempo
  paymentDate       DateTime?     @map("payment_date") @db.Date // Tanggal pembayaran
  totalAmount       Int           @map("total_amount") // Jumlah keseluruhan
  principalAmount   Int           @map("principal_amount") // Jumlah pokok
  interestAmount    Int           @map("interest_amount") // Jumlah bunga
  paidAmount        Int           @default(0) @map("paid_amount") // Jumlah yang dibayar
  lateFeeAmount     Int           @default(0) @map("late_fee_amount") // Denda keterlambatan
  status            PaymentStatus @default(PENDING) @map("status") // Status pembayaran
  daysOverdue       Int           @default(0) @map("days_overdue") // Hari keterlambatan

  loanReferenceId String        @map("loan_reference_id") @db.VarChar(56)
  loanReference   LoanReference @relation(fields: [loanReferenceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_payment_record_id")
  @@index([installmentNumber], name: "idx_payment_record_installment_number")
  @@index([dueDate], name: "idx_payment_record_due_date")
  @@index([paymentDate], name: "idx_payment_record_payment_date")
  @@index([totalAmount], name: "idx_payment_record_total_amount")
  @@index([principalAmount], name: "idx_payment_record_principal_amount")
  @@index([interestAmount], name: "idx_payment_record_interest_amount")
  @@index([paidAmount], name: "idx_payment_record_paid_amount")
  @@index([lateFeeAmount], name: "idx_payment_record_late_fee_amount")
  @@index([status], name: "idx_payment_record_status")
  @@index([daysOverdue], name: "idx_payment_record_days_overdue")
  @@index([loanReferenceId], name: "idx_payment_record_loan_reference_id")
  @@index([createdAt], name: "idx_payment_record_created_at")
  @@index([updatedAt], name: "idx_payment_record_updated_at")
  @@map("payment_records")
}

model Report {
  id          String     @id @default(uuid()) @map("id") @db.VarChar(56)
  reportType  ReportType @map("report_type") // Jenis laporan
  title       String     @map("title") @db.VarChar(255) // Judul laporan
  description String?    @map("description") @db.Text // Deskripsi laporan
  startDate   DateTime   @map("start_date") @db.Date // Tanggal mulai periode laporan
  endDate     DateTime   @map("end_date") @db.Date // Tanggal akhir periode laporan
  fileUrl     String?    @map("file_url") // URL file laporan yang digenerate
  generatedBy String     @map("generated_by") @db.VarChar(56) // ID user yang membuat laporan

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([id], name: "idx_report_id")
  @@index([reportType], name: "idx_report_report_type")
  @@index([title], name: "idx_report_title")
  @@index([description], name: "idx_report_description")
  @@index([startDate], name: "idx_report_start_date")
  @@index([endDate], name: "idx_report_end_date")
  @@index([fileUrl], name: "idx_report_file_url")
  @@index([generatedBy], name: "idx_report_generated_by")
  @@index([createdAt], name: "idx_report_created_at")
  @@index([updatedAt], name: "idx_report_updated_at")
  @@map("reports")
}
